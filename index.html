<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Financial Harmony</title>
  <!-- Favicon/logo -->
  <link rel="icon" type="image/png" href="logo.png" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" />
  <!-- RemixIcon for icons -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <!-- TradingView Widget -->
  <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
  <!-- Auth0 SPA JS SDK -->
  <script src="https://cdn.auth0.com/js/auth0-spa-js/2.1/auth0-spa-js.production.js"></script>
  <style>
    :root {
      --primary: #f7931a; /* Bitcoin orange */
      --primary-hover: #d87a16;
      --primary-light: #fff3e0;
      --bg: #ffffff;
      --text: #4d4d4d;
      --muted: #666666;
      --border: #e5e5e5;
      --card: #f9f9f9;
      --accent: #0d579b; /* Bitcoin blue for accents */
      --radius: 16px;
      --shadow: 0 2px 8px rgba(0,0,0,0.1);
      --transition: 0.2s;
    }
    html, body { height: 100%; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow: hidden;
      transition: background .3s, color .3s;
    }
    /* Sidebar simplified */
    .sidebar {
      width: 80px;
      background: var(--card);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px 0;
      gap: 4px;
      z-index: 2;
      position: fixed;
      height: 100vh;
      transition: width var(--transition);
    }
    .sidebar .logo {
      width: 56px; height: 56px;
      background: var(--primary-light);
      border-radius: 16px;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 18px;
      padding: 0;
      border: 2px solid var(--primary);
      overflow: hidden;
    }
    .sidebar .logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    /* Topbar with logo and name */
    .topbar {
      position: fixed;
      width: calc(100% - 80px);
      left: 80px;
      background: linear-gradient(95deg, var(--primary) 0%, #f5a623 90%);
      height: 64px;
      display: flex;
      align-items: center;
      padding: 0 24px;
      z-index: 1;
      border-bottom: 1px solid var(--border);
      transition: background var(--transition);
    }
    .topbar .header {
      display: flex;
      align-items: center;
      gap: 12px;
      color: #fff;
    }
    .topbar .header .logo-small {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }
    .topbar .header h1 {
      font-size: 24px;
      font-weight: 700;
      margin: 0;
    }
    .topbar .profile {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .topbar .profile img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #fff;
      padding: 4px;
      border: 1px solid #fff;
    }
    .topbar .profile .name { font-weight: 600; font-size: 16px; color: #fff; }
    /* Main Content */
    .main-content {
      margin-left: 80px;
      padding: 88px 24px 24px;
      overflow-y: auto;
      height: calc(100vh - 64px);
      transition: margin-left var(--transition);
    }
    .main-content h2 { font-size: 24px; margin-bottom: 24px; color: var(--primary); }
    .section { margin-bottom: 32px; background: var(--card); border-radius: var(--radius); padding: 24px; box-shadow: var(--shadow); }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px; border: 1px solid var(--border); text-align: left; }
    th { background: var(--primary-light); color: var(--text); }
    #news-feed li { margin: 10px 0; }
    #news-feed li a { color: var(--primary); text-decoration: none; }
    #news-feed li a:hover { text-decoration: underline; }
    .steps { background: var(--primary-light); padding: 20px; border-radius: var(--radius); margin-top: 20px; }
    label { display: block; margin: 10px 0; font-size: 1.1em; color: var(--text); }
    input[type="text"] { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; margin-top: 5px; }
    button { background: var(--primary); color: #fff; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: var(--transition); }
    button:hover { background: var(--primary-hover); }
  </style>
  <script src="https://widgets.coingecko.com/coingecko-coin-price-marquee-widget.js"></script>
</head>
<body>
  <div class="sidebar">
    <div class="logo">
      <img src="logo.png" alt="Financial Harmony Logo">
    </div>
  </div>
  <div class="topbar">
    <div class="header">
      <img src="logo.png" alt="Logo" class="logo-small">
      <h1>Financial Harmony</h1>
    </div>
    <div class="profile">
      <img src="default-profile.jpg" alt="Profile">
      <span class="name">User</span>
    </div>
  </div>
  <div class="main-content">
    <div id="login" style="display: block;">
      <button id="login-button">Iniciar Sesión con Auth0</button>
    </div>
    <div id="dashboard" style="display: none;">
      <h2>Dashboard Crypto</h2>
      <div class="section">
        <h3>Precios de Criptomonedas de Alto Volumen</h3>
        <table id="prices-table">
          <thead><tr><th>Moneda</th><th>Precio (USD)</th><th>Cambio 24h</th><th>Volumen 24h</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="section">
        <h3>Noticias Crypto Actualizadas</h3>
        <ul id="news-feed"></ul>
      </div>
      <div class="section">
        <h3>Información sobre Bitcoin</h3>
        <p id="btc-info">Cargando...</p>
      </div>
      <div class="section">
        <h3>Gráfico de Precios (TradingView)</h3>
        <div id="tradingview-widget" style="height: 400px; width: 100%;"></div>
      </div>
      <!-- Flujo de Pasos -->
      <div id="steps" class="steps">
        <h3>Paso 1: Sigue las Redes Sociales</h3>
        <label><input type="checkbox" id="follow1"> Sigue Twitter/X de BTC</label><br>
        <label><input type="checkbox" id="follow2"> Sigue Instagram de Crypto</label><br>
        <label><input type="checkbox" id="follow3"> Sigue YouTube de Trading</label><br>
        <button id="next-follow">Siguiente</button>
        
        <div id="quiz" style="display:none;">
          <h3>Paso 2: Cuestionario - Curso de BTC</h3>
          <p>1. ¿Qué es Bitcoin? <input type="text" id="q1"></p>
          <p>2. ¿Quién creó BTC? <input type="text" id="q2"></p>
          <p>3. ¿Qué es Blockchain? <input type="text" id="q3"></p>
          <button id="submit-quiz">Finalizar</button>
        </div>
        
        <div id="telegram-link" style="display:none;">
          <h3>¡Listo! Únete al Grupo de Telegram</h3>
          <a href="https://t.me/tu_grupo_telegram" target="_blank">Ir al Curso en Telegram</a>
        </div>
      </div>
      <button id="logout-button">Cerrar Sesión</button>
    </div>
  </div>
  <script>
    let auth0Client;
    let userProfile;

    async function initAuth0() {
      auth0Client = await createAuth0Client({
        domain: 'TU_DOMAIN_AUTH0',
        clientId: 'TU_CLIENT_ID',
        authorizationParams: {
          redirect_uri: window.location.origin
        }
      });

      if (location.search.includes("code=") && location.search.includes("state=")) {
        await auth0Client.handleRedirectCallback();
        window.history.replaceState({}, document.title, "/");
      }

      const isAuthenticated = await auth0Client.isAuthenticated();
      updateUI(isAuthenticated);

      if (isAuthenticated) {
        userProfile = await auth0Client.getUser();
        updateUI(isAuthenticated);
      }
    }

    function updateUI(isAuthenticated) {
      document.getElementById('login').style.display = isAuthenticated ? 'none' : 'block';
      document.getElementById('dashboard').style.display = isAuthenticated ? 'block' : 'none';

      if (isAuthenticated) {
        loadTopVolumeCoins();
        loadNews();
        loadBtcInfo();
        setInterval(loadNews, 60000);
        document.querySelector('.profile .name').textContent = userProfile.name || 'User';
        document.querySelector('.profile img').src = userProfile.picture || 'default-profile.jpg';
      }
    }

    document.getElementById('login-button').addEventListener('click', async () => {
      await auth0Client.loginWithRedirect();
    });

    document.getElementById('logout-button').addEventListener('click', async () => {
      await auth0Client.logout({
        logoutParams: {
          returnTo: window.location.origin
        }
      });
    });

    initAuth0();

    // Load top volume coins from CoinGecko
    function loadTopVolumeCoins() {
      fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=volume_desc&per_page=10&page=1')
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector('#prices-table tbody');
          tbody.innerHTML = '';
          data.forEach(coin => {
            const row = `<tr><td>${coin.name}</td><td>$${coin.current_price.toFixed(2)}</td><td>${coin.price_change_percentage_24h.toFixed(2)}%</td><td>$${coin.total_volume.toLocaleString()}</td></tr>`;
            tbody.innerHTML += row;
          });
        }).catch(err => console.error('Error loading coins:', err));
      setTimeout(loadTopVolumeCoins, 60000); // Refresh every 60s
    }

    // Load News
    function loadNews() {
      const apiKey = '6a2f3e0ca4454b59a566896f49560316';
      fetch(`https://newsapi.org/v2/everything?q=bitcoin OR crypto&sortBy=publishedAt&language=es&pageSize=10&apiKey=${apiKey}`)
        .then(res => res.json())
        .then(data => {
          const feed = document.getElementById('news-feed');
          feed.innerHTML = '';
          if (data.articles && data.articles.length > 0) {
            data.articles.forEach(article => {
              const date = new Date(article.publishedAt).toLocaleString('es-ES');
              feed.innerHTML += `<li><a href="${article.url}" target="_blank">${article.title}</a> - ${article.source.name} (${date})</li>`;
            });
          } else {
            feed.innerHTML = '<li>No hay noticias disponibles.</li>';
          }
        }).catch(err => {
          console.error('Error fetching news:', err);
          document.getElementById('news-feed').innerHTML = '<li>Error al cargar noticias.</li>';
        });
    }

    // Load BTC Info
    function loadBtcInfo() {
      fetch('https://api.coingecko.com/api/v3/coins/bitcoin')
        .then(res => res.json())
        .then(data => {
          document.getElementById('btc-info').innerHTML = `Precio: $${data.market_data.current_price.usd.toFixed(2)}<br>Market Cap: $${data.market_data.market_cap.usd.toLocaleString()}<br>Dominance: ${data.market_data.market_cap_change_percentage_24h_in_currency.usd.toFixed(2)}%`;
        }).catch(err => console.error('Error loading BTC info:', err));
    }

    // TradingView Graph
    new TradingView.widget({
      "width": "100%",
      "height": 400,
      "symbol": "BINANCE:BTCUSDT",
      "interval": "D",
      "timezone": "Etc/UTC",
      "theme": "light",
      "style": "1",
      "locale": "es",
      "toolbar_bg": "#f1f3f6",
      "enable_publishing": false,
      "allow_symbol_change": true,
      "studies": ["MACD"],
      "container_id": "tradingview-widget"
    });

    // Steps Flow
    document.getElementById('next-follow').addEventListener('click', () => {
      if (document.querySelectorAll('input[type="checkbox"]:checked').length === 3) {
        document.getElementById('quiz').style.display = 'block';
      } else {
        alert('Debes seguir todas las redes.');
      }
    });

    document.getElementById('submit-quiz').addEventListener('click', () => {
      if (document.getElementById('q1').value && document.getElementById('q2').value && document.getElementById('q3').value) {
        document.getElementById('telegram-link').style.display = 'block';
      } else {
        alert('Responde todas las preguntas.');
      }
    });
  </script>
</body>
</html>
